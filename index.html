<body style="background: white"></body>
<script src="https://cdn.jsdelivr.net/gh/netizenorg/netnet-standard-library/build/nn.min.js"></script>
<script src="https://unpkg.com/tone"></script>
<script src="https://algorithmicmusic.online/js/viz-helpers.js"></script>
<script>
/* global nn, Tone, viz */

const wave = viz.createWaveform()
const spec = viz.createSpectrum({ range: [20, 7040] })

const source = new Tone.PulseOscillator({
  frequency: 200,
  width: 0.5
}).toDestination();

const lfo = new Tone.LFO({
  frequency: 2,
  min: 0,
  max: 0.1
})

const volume = new Tone.Gain(0.01)

const effect1 = new Tone.Tremolo({
  frequency: 5,
  type: "sine",
  depth: 0.5,
  spread: 180
})

const effect2 = new Tone.PingPongDelay()

source.connect(effect1)
effect1.connect(effect2)
effect2.connect(volume)
lfo.connect(volume.gain)

effect1.start()
// effect2.start()

lfo.start()

volume.toDestination()

volume.connect(wave)
volume.connect(spec)

let playing = false

function start_or_stop_playing(){
  if (playing) {
    source.stop()
    button.content("start")
    playing = false
  }
  else {
    source.start()
    button.content("stop")
    playing = true
  }
}

const button = nn.create("button")
                .css({
                  backgroundColor: "pink"
                })
                .content("start")
                .addTo("body")
                .on("click", () => start_or_stop_playing())

nn.create("img")
  .set({
  src: "graph"
})
  .addTo("body")

  
</script>