<body style="background: white"></body>
<script src="https://cdn.jsdelivr.net/gh/netizenorg/netnet-standard-library/build/nn.min.js"></script>
<script src="https://unpkg.com/tone"></script>
<script src="https://algorithmicmusic.online/js/viz-helpers.js"></script>
<script>
/* global nn, Tone, viz */
  
/*

Short Reflection: 

I basically started this week's assignment by trying and listening to the examples on the course website. I really liked the effect of Tremolo so I included it, and also included a PulseOscillator. 

I also liked the PingPongDelay effect so I added that as well, and I used LFO to change the width of the PulseOscillator, and a different LFO to change the volume.

*/

const wave = viz.createWaveform()
const spec = viz.createSpectrum({ range: [20, 7040] })

const source = new Tone.PulseOscillator({
  frequency: 200,
  width: 0.5
})

const lfo1 = new Tone.LFO({
  frequency: 2,
  min: 0,
  max: 1
}) 
  
const lfo2 = new Tone.LFO({
  frequency: 2,
  min: 0,
  max: 0.05
})

const volume = new Tone.Gain(0.025)

const effect1 = new Tone.Tremolo({
  frequency: 5,
  type: "sine",
  depth: 0.5,
  spread: 180
})

const effect2 = new Tone.PingPongDelay()

source.connect(effect1)
effect1.connect(effect2)
effect2.connect(volume)
lfo1.connect(source.width)
lfo2.connect(volume.gain)

effect1.start()

lfo1.start()
lfo2.start()

volume.toDestination()

volume.connect(wave)
volume.connect(spec)

let playing = false

function start_or_stop_playing(){
  if (playing) {
    source.stop()
    button.content("start")
    playing = false
  }
  else {
    source.start()
    button.content("stop")
    playing = true
  }
}

const button = nn.create("button")
                .css({
                  backgroundColor: "pink"
                })
                .content("start")
                .addTo("body")
                .on("click", () => start_or_stop_playing())

nn.create('br').addTo('body')

nn.create("img")
  .set({
  src: "signal_diagram_final.jpg"
})
  .css({
  width: nn.width,
  height: nn.width / 2
})
  .addTo("body")

  
</script>